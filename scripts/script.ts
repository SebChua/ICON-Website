//#region Team Member Info JSON
let team = {
    "Executive": [
        {
            "firstName": "Sebastian",
            "lastName": "Chua",
            "division": "Executive",
            "role": "Project Manager",
            "key": "sebastianchua"
        },
        {
            "firstName": "Ivan",
            "lastName": "Darmawan",
            "division": "Executive",
            "role": "Project Manager",
            "key": "ivandarmawan"
        },
        {
            "firstName": "Adrian",
            "lastName": "Santoso",
            "division": "Executive",
            "role": "Secretary",
            "key": "adrianbagus"
        },
        {
            "firstName": "Audrey",
            "lastName": "Patricia",
            "division": "Executive",
            "role": "Secretary",
            "key": "audreypatricia"
        }
    ],
    "Events": [
        {
            "firstName": "Verren",
            "lastName": "Jesilia",
            "division": "Events",
            "role": "Events Director",
            "key": "verrenjesilia"
        },
        {
            "firstName": "Selina",
            "lastName": "Nicole",
            "division": "Events",
            "role": "Committee",
            "key": "selinanicole"
        },
        {
            "firstName": "Felia",
            "lastName": "Clarissa",
            "division": "Events",
            "role": "Committee",
            "key": "feliaclarissa"
        },
        {
            "firstName": "Ivana",
            "lastName": "Widjaja",
            "division": "Events",
            "role": "Committee",
            "key": "ivanawidjaja"
        }
    ],
    "Marketing": [
        {
            "firstName": "Glen",
            "lastName": "Odang",
            "division": "Marketing",
            "role": "Marketing Director",
            "key": "glenodang"
        },
        {
            "firstName": "Michelle",
            "lastName": "Gracia",
            "division": "Marketing",
            "role": "Committee",
            "key": "michellegracia"
        },
        {
            "firstName": "Williyanti",
            "lastName": "Tjoa",
            "division": "Marketing",
            "role": "Committee",
            "key": "williyantitjoa"
        },
        {
            "firstName": "Glenn",
            "lastName": "Kadarusman",
            "division": "Marketing",
            "role": "Committee",
            "key": "glennkadarusman"
        }
    ],
    "Design": [
        {
            "firstName": "Shannen",
            "lastName": "Patricia",
            "division": "Design",
            "role": "Design Director",
            "key": "shannenpatricia"
        },
        {
            "firstName": "Devi",
            "lastName": "Arifianti",
            "division": "Design",
            "role": "Committee",
            "key": "deviarifianti"
        },
        {
            "firstName": "Elena",
            "lastName": "Hadinata",
            "division": "Design",
            "role": "Committee",
            "key": "elenahadinata"
        }
    ],
    "Liaison Officers": [
        {
            "firstName": "Calista",
            "lastName": "Amarati",
            "division": "Liaison Officer",
            "role": "Liaison Officer Director",
            "key": "calistaamarati"
        },
        {
            "firstName": "Adrian",
            "lastName": "Santoso",
            "division": "Liaison Officer",
            "role": "Liaison Officer",
            "key": "adrianbagus"
        },
        {
            "firstName": "Josella",
            "lastName": "Rachmat",
            "division": "Liaison Officer",
            "role": "Liaison Officer",
            "key": "josellarachmat"
        },
        {
            "firstName": "Elsa",
            "lastName": "Tjendana",
            "division": "Liaison Officer",
            "role": "Liaison Officer",
            "key": "elsatjendana"
        },
        {
            "firstName": "Shafira",
            "lastName": "Kurniadewi",
            "division": "Liaison Officer",
            "role": "Liaison Officer",
            "key": "shafirakurniadewi"
        }
    ],
    "Sponsorship": [
        {
            "firstName": "Cornelia",
            "lastName": "Michelle",
            "division": "Sponsorship",
            "role": "Sponsorship Director",
            "key": "corneliamichelle"
        },
        {
            "firstName": "Ezra",
            "lastName": "Bagaskara",
            "division": "Sponsorship",
            "role": "Committee",
            "key": "ezrabagaskara"
        },
        {
            "firstName": "Melinda",
            "lastName": "Saputera",
            "division": "Sponsorship",
            "role": "Committee",
            "key": "melindasaputera"
        },
        {
            "firstName": "Karen",
            "lastName": "Devanie",
            "division": "Sponsorship",
            "role": "Committee",
            "key": "karendevanie"
        }
    ],
    "Logistics": [
        {
            "firstName": "Marchia",
            "lastName": "Devana",
            "division": "Logistics",
            "role": "Logistics Director",
            "key": "marchiadevana"
        },
        {
            "firstName": "Meta",
            "lastName": "Agustina",
            "division": "Logistics",
            "role": "Committee",
            "key": "metaagustina"
        },
        {
            "firstName": "Sharon",
            "lastName": "Giovanni",
            "division": "Logistics",
            "role": "Committee",
            "key": "sharongiovani"
        },
        {
            "firstName": "Vincent",
            "lastName": "Julio",
            "division": "Logistics",
            "role": "Committee",
            "key": "vincentjulio"
        },
        {
            "firstName": "Anastasia",
            "lastName": "Kristabella",
            "division": "Logistics",
            "role": "Committee",
            "key": "anastasiakristabella"
        },
        {
            "firstName": "Carina",
            "lastName": "Sulianto",
            "division": "Logistics",
            "role": "Committee",
            "key": "carinasulianto"
        },
        {
            "firstName": "Nicholas",
            "lastName": "Enstein",
            "division": "Logistics",
            "role": "Committee",
            "key": "nicholasenstein"
        }
    ]
};
//#endregion

//#region Speaker Info JSON
let speakers = {
    "2017": [
        {
            "name": "Alamanda Shantika",
            "title": "Founder & CEO",
            "organisation": "Binar Academy"
        }, 
        {
            "name": "Daniel Mananta",
            "title": "Founder & CEO",
            "organisation": "DAMN! I LOVE INDONESIA"
        },
        {
            "name": "Andy F. Noya",
            "title": "Host",
            "organisation": "Kick Andy"
        },
        {
            "name": "Noor Huda Ismail",
            "title": "Founder",
            "organisation": "Institute for International Peace Building Indonesia"
        },
        {
            "name": "Isyana Sarasvati",
            "title": "Performer",
            "organisation": ""
        }
    ],
    "2018": [
        {
            "name": "William Tanuwidjaja",
            "title": "Co-Founder & CEO",
            "organisation": "Tokopedia"
        }, 
        {
            "name": "Chelsea Islan",
            "title": "Co-Founder & President",
            "organisation": "Youth of Indonesia"
        },
        {
            "name": "Putra Nababan",
            "title": "Ex-Editor In Chief",
            "organisation": "Metro TV"
        },
        {
            "name": "Faye Simanjuntak",
            "title": "Founder",
            "organisation": "Rumah Faye"
        },
        {
            "name": "Arnold Poernomo",
            "title": "Chef & Judge",
            "organisation": "Masterchef Indonesia"
        },
        {
            "name": "Jaz",
            "title": "Performer",
            "organisation": ""
        }
    ],
    "2019": [
        {
            "name": "Pandji Pragiwoksono",
            "title": "Comedian, Director, Influencer",
            "organisation": ""
        },
        {
            "name": "David Soong",
            "title": "Founder",
            "organisation": "Axioo"
        },
        {
            "name": "Sabrina Bensawan",
            "title": "Founder",
            "organisation": "Saab Shares"
        },
        {
            "name": "Rizky Febian",
            "title": "Performer",
            "organisation": ""
        }
    ]
}
//#endregion

//#region Website Content
let content = {
    social_media: {
        facebook: 'https://www.facebook.com/PPIA.ICON2019/',
        instagram: 'https://www.instagram.com/icon_2019/',
        email: 'mailto:unsw.ppia@gmail.com',
        tickets: 'https://tinyurl.com/icon2k19'
    },
    event_details: {
        date: 'July 27, 2019',
        venue: 'Wesley Conference Center',
        place: 'Pitt St, Sydney NSW 2000'
    },
    about_section: {
        text: 'ICON is a platform for sharing IDEAS to INSPIRE the next generation of Indonesians to make an IMPACT. \
              It is a non-profit conference where influential speakers come and spread ideas, catalyzing development \
              and drive for the future generation of Indonesians.',
    },
    charity_section: {
        name: 'Saab Shares',
        text: 'Saab Shares is a non-profit organization which focuses on empowering the underprivileged, focusing on \
                providing an education alongside character-building sessions to focus on breaking the cycle of poverty \
                for our future generation. Saab Shares also aims to provide support in healthcare and women empowerment.',
        link: 'https://saabshares.org/en/index.php'
    }
}
//#endregion

$(document).ready(() => {
    applyHeaderEffects();
    buildThemeSection();
    buildEventDetailsSection();
    buildSpeakersSection();
    buildAboutSection();
    buildCharitySection();
    buildTeamSection();
});

function addButton(link: string, text: string, target_container: JQuery) {
    $('<a>').prop({
        href: link,
        target: '_blank'
    }).addClass(['btn', 'btn-primary']).text(text).appendTo(target_container);
}

function applyHeaderEffects() {
    $('#theme-section img').css('max-height', $(window).height());

    // Scroll Effects on Header Navigation
    $(window).scroll(() => {
        let distanceFromTop = $('#theme-section').height() - 600;
        if ($(this).scrollTop() > distanceFromTop - $('#main-nav').height()) {
            $('#main-nav').css('background-color', 'rgba(0, 0, 0, 0.8)');
        } else {
            $('#main-nav').css('background-color', 'rgba(0, 0, 0, 0.10)');
        }
    });
}

function buildThemeSection() {
    // Backgrounds for divs are pre-specified in index.scss
    // Attaching both fade in and parallax effects into the layers
    let shape_layer = $('#theme-section .shapes-layer').data('depth', 0.5);
    let text_layer = $('#theme-section .text-layer').data('depth', 0.6);
    let layers: JQuery[] = [shape_layer, text_layer];

    for (let layer of layers)
        layer.addClass('animated fadeIn');

    $(window).scroll(() => {
        // Referenced from:
        // https://medium.com/@PatrykZabielski/how-to-make-multi-layered-parallax-illustration-with-css-javascript-2b56883c3f27
        for (let layer of layers) {
            /* Adds the parallax effect by translating down the background image
             * by the depth property by the scroll position from the top */
            let translate_by = -1 * (window.scrollY * layer.data('depth'));
            layer.css('transform', 'translateY(' + translate_by + 'px)');
        }
    });
}

function buildEventDetailsSection() {
    let details_section = $('#event-details');
    let details_row = $('<div>').addClass('row');
    let social_col_div = $('<div>').addClass('event-social-column col-5');
    let details_div = $('<div>').addClass('venue-time col-5');
    
    let social_col = $('<ul>').prop('id', 'social-column');
    buildSocialMediaList(social_col);
    social_col.appendTo(social_col_div);
    
    $('<h1>').addClass('date').text(content.event_details['date']).appendTo(details_div);
    $('<h4>').addClass('venue').text(content.event_details['venue']).appendTo(details_div);
    $('<h5>').addClass('place').text(content.event_details['place']).appendTo(details_div);
    addButton(content.social_media['tickets'], 'Get Tickets', details_div);

    details_row.append(social_col_div);
    details_row.append($('<div>').addClass('separator col-auto'));
    details_row.append(details_div);
    details_section.append(details_row);
}

/**
 * Populates an unordered list container with social media icons and links
 * @param container <uL> Jquery container that contains the social media list
 */
function buildSocialMediaList(container: JQuery) {
    let media_buttons = {
        'facebook': $('<a>').prop({
                        target: '_blank',
                        href: content.social_media['facebook']
                    }).addClass(['fab', 'fa-facebook-f', 'fa-lg']),
        'instagram': $('<a>').prop({
                        target: '_blank',
                        href: content.social_media['instagram']
                    }).addClass(['fab', 'fa-instagram', 'fa-lg']),
        'email': $('<a>').prop({
                    href: content.social_media['email']
                }).addClass(['fas', 'fa-envelope', 'fa-lg'])
    }
    $('<li>').append(media_buttons['facebook']).appendTo(container);
    $('<li>').append(media_buttons['instagram']).appendTo(container);
    $('<li>').append(media_buttons['email']).appendTo(container);
}

function buildSpeakersSection() {
    buildSpeakerPhotos('2019');

    $('#speaker-history-row a').on('click', () => {
        // Strips 'ICON ' from the link text
        let year = $('#speaker-history-row').find('a:focus').text().substr(5);
        buildSpeakerPhotos(year);
    })
}

function buildSpeakerPhotos(year: string) {
    $('#speaker-content-row').html('');

    if (speakers[year].length === 0) {
        let coming_soon = $('<div>').prop('id', 'coming-soon').addClass('container-fluid text-center');
        let heading_text = $('<h1>').text('Be the first to know the ICONs of 2019!');
        let social_row = $('<ul>');

        buildSocialMediaList(social_row);
        coming_soon.append(heading_text);
        coming_soon.append(social_row);
        attachRandomFadeIn(coming_soon);
        $('#speaker-content-row').append(coming_soon);
    } else {
        // $('.speaker-div').css('flex', 100 / speakers[year].length + '%');
        console.log(year);
        for (let i = 0; i < speakers[year].length; i++) {
            // let speaker_container = $('<div>').text(' ').addClass('speaker-div speaker-img' + (i + 1));
            let speaker_container = $('<div>').text(' ').addClass('speaker-div col-lg speaker-img' + (i + 1));
            let overlay = $('<div>').addClass('overlay').appendTo(speaker_container);
            let details = $('<div>').addClass('details').appendTo(overlay);
            
            $('<h1>').text(speakers[year][i].name).appendTo(details);
            $('<h3>').text(speakers[year][i].title).appendTo(details);
            $('<h2>').text(speakers[year][i].organisation).appendTo(details);
            attachRandomFadeIn(speaker_container);
            $('#speaker-content-row').append(speaker_container);
        }
    }
}

function buildAboutSection() {
    let about_section = $('#about-section');

    let about_row = $('<div>').addClass('row');


    let about_heading = $('<div>').addClass('about-heading col-4');
    $('<h1>').text('About ICON').appendTo(about_heading);

    let about_details = $('<div>').addClass('about-details col-6');
    $('<p>').text(content.about_section['text']).appendTo(about_details);

    about_row.append(about_heading);
    about_row.append($('<div>').addClass('separator col-auto'));
    about_row.append(about_details);
    about_section.append(about_row);
}

function buildCharitySection() {
    let charity_section = $('#charity-section');

    let charity_row = $('<div>').addClass('row');

    let charity_heading = $('<div>').addClass('charity-heading col-4');
    $('<h1>').text('Our Charity').appendTo(charity_heading);
    $('<h2>').text(content.charity_section['name']).appendTo(charity_heading);

    let charity_details = $('<div>').addClass('charity-details col-7');
    $('<p>').text(content.charity_section['text']).appendTo(charity_details);
    addButton(content.charity_section['link'], 'Learn More', charity_details);

    charity_row.append(charity_details);
    charity_row.append($('<div>').addClass('separator'));
    charity_row.append(charity_heading);
    charity_section.append(charity_row);
}

function buildTeamSection() {
    buildTeamPhotos('Executive');
    $('#teams-row a').on('click', () => {
        $('#team-photo-section').html('');
        let division = $('#teams-row').find('a:focus').text();
        buildTeamPhotos(division);
    });
}

function buildTeamPhotos(division: string) {
    let photoContainer: JQuery = $('<div>').addClass('d-flex flex-wrap justify-content-center');
    
    for (let member of team[division]) {
        let profile: JQuery = $('<div class="profile">');
        $('<img>').prop('src', buildImageURL(member)).appendTo(profile);
        $('<h4>').text(member.firstName + ' ' + member.lastName).appendTo(profile);
        $('<h6>').text(member.role).appendTo(profile);
        
        // Randomises the fade in animation time to create a twinkle star fade in effect
        attachRandomFadeIn(profile);
        profile.appendTo(photoContainer);
    }
    photoContainer.appendTo($('#team-photo-section'));
}

//#region Helper Functions
function buildImageURL(member: TeamMember): string {
    return '../assets/team-photos/' + 
            normalise(member.division) + 
            '/' + member.firstName + '-' + member.lastName + '.jpg';
}

/** Randomises the fade in animation time to create a twinkle star fade in effect */
function attachRandomFadeIn(container: JQuery) {
    let delay = Math.random() * 0.2;
    container.css('animation-delay', delay + 's');
    container.addClass('animated fadeIn');
}

function normalise(str: string): string {
    return str.replace(/\s/g,'').toLowerCase();
}
//#endregion

interface TeamMember {
    firstName: string,
    lastName: string,
    division: string,
    role: string
}